<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frondoso - Portal del Empleado</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --forest:#1a3a2a;--moss:#2d6a4f;--leaf:#52b788;--mint:#95d5b2;
  --mist:#d8f3dc;--cream:#faf8f2;--ink:#1c1c1c;--stone:#6b7280;
  --amber:#d97706;--amber-lt:#fef3c7;--error:#dc2626;--error-lt:#fef2f2;
  --success:#059669;--success-lt:#ecfdf5;--green-pale:#f0faf3;--green-light:#d8f3dc;
}
body{font-family:'DM Sans',sans-serif;background:var(--cream);min-height:100vh;color:var(--ink);overflow-x:hidden}

/* ── LOGIN ────────────────────────────────────────────── */
#loginPage{position:fixed;inset:0;z-index:9999;display:flex;background:var(--forest)}
#loginPage.out{animation:fadeOut .5s forwards}
@keyframes fadeOut{to{opacity:0;transform:scale(1.02)}}

.login-left{flex:1;display:flex;flex-direction:column;justify-content:center;padding:60px 64px;position:relative;overflow:hidden}
.login-left::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 20% 80%,rgba(82,183,136,.18) 0%,transparent 60%),radial-gradient(ellipse 50% 60% at 80% 20%,rgba(149,213,178,.1) 0%,transparent 60%);pointer-events:none}
.ll-leaf{position:absolute;pointer-events:none;opacity:.06}
.ll-leaf.a{bottom:-80px;left:-60px;width:380px;transform:rotate(-30deg)}
.ll-leaf.b{top:-100px;right:-40px;width:300px;transform:rotate(40deg)}
.login-brand{display:flex;align-items:center;gap:14px;margin-bottom:56px;position:relative;z-index:1}
.login-brand-mark{width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--leaf),var(--mint));display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 8px 24px rgba(82,183,136,.3)}
.login-brand-name{font-family:'DM Serif Display',serif;font-size:28px;color:#fff}
.login-brand-tag{font-size:12px;color:var(--mint);letter-spacing:.1em;text-transform:uppercase;font-weight:500}
.login-headline{font-family:'DM Serif Display',serif;font-size:52px;line-height:1.05;color:#fff;margin-bottom:20px;position:relative;z-index:1}
.login-headline em{font-style:italic;color:var(--mint)}
.login-sub{font-size:16px;color:rgba(255,255,255,.55);line-height:1.6;max-width:360px;position:relative;z-index:1;margin-bottom:48px}
.login-feats{display:flex;flex-direction:column;gap:12px;position:relative;z-index:1}
.login-feat{display:flex;align-items:center;gap:12px;color:rgba(255,255,255,.7);font-size:14px}
.login-feat-icon{width:28px;height:28px;border-radius:8px;background:rgba(82,183,136,.15);border:1px solid rgba(82,183,136,.3);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}

.login-right{width:440px;flex-shrink:0;background:var(--cream);display:flex;flex-direction:column;justify-content:center;padding:56px 48px;position:relative;box-shadow:-20px 0 60px rgba(0,0,0,.2)}
.login-right::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--leaf),var(--mint))}
.login-title{font-family:'DM Serif Display',serif;font-size:30px;color:var(--forest);margin-bottom:6px}
.login-subtitle{font-size:14px;color:var(--stone);margin-bottom:36px}

.lfield{display:flex;flex-direction:column;gap:6px;margin-bottom:18px}
.lfield label{font-size:12px;font-weight:600;color:var(--moss);text-transform:uppercase;letter-spacing:.07em}
.lfield input{font-family:'DM Sans',sans-serif;font-size:14px;color:var(--ink);background:#fff;border:1.5px solid #e5e5e0;border-radius:10px;padding:12px 16px;outline:none;transition:border-color .2s,box-shadow .2s;width:100%}
.lfield input:focus{border-color:var(--leaf);box-shadow:0 0 0 3px rgba(82,183,136,.12)}
.lfield input.err{border-color:var(--error)}

.login-remember{display:flex;align-items:center;gap:8px;margin-bottom:24px;cursor:pointer}
.login-remember input{width:16px;height:16px;accent-color:var(--moss);cursor:pointer}
.login-remember span{font-size:13px;color:var(--stone)}

.btn-login{width:100%;background:linear-gradient(135deg,var(--moss),var(--forest));color:#fff;border:none;border-radius:12px;padding:14px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;box-shadow:0 4px 14px rgba(45,106,79,.3);letter-spacing:.02em}
.btn-login:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(45,106,79,.4)}
.btn-spin{display:none;width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading .btn-spin{display:block}
.loading .btn-txt{opacity:0}

.login-err-box{background:var(--error-lt);border:1px solid rgba(220,38,38,.2);border-radius:10px;padding:12px 14px;font-size:13px;color:var(--error);margin-bottom:18px;display:none;align-items:center;gap:8px}
.login-err-box.show{display:flex}

.login-hint{margin-top:20px;padding-top:20px;border-top:1px solid var(--mist);text-align:center}
.login-hint p{font-size:12px;color:var(--stone)}
.demo-chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
.chip{background:var(--mist);border:1px solid var(--mint);border-radius:8px;padding:6px 12px;font-size:11px;color:var(--moss);cursor:pointer;transition:all .15s;font-weight:500}
.chip:hover{background:var(--leaf);color:#fff;border-color:var(--leaf)}

/* ── APP ────────────────────────────────────────────── */
#appWrapper{display:none;flex-direction:column;min-height:100vh}

header{background:var(--forest);padding:0 40px;display:flex;align-items:center;justify-content:space-between;height:68px;box-shadow:0 2px 20px rgba(26,58,42,.25)}
.logo{display:flex;align-items:center;gap:12px}
.logo-mark{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--leaf),var(--mint));display:flex;align-items:center;justify-content:center;font-size:18px}
.logo-name{font-family:'DM Serif Display',serif;font-size:22px;color:#fff}
.logo-sub{font-size:11px;color:var(--mint);letter-spacing:.12em;text-transform:uppercase;font-weight:500}
.header-user{display:flex;align-items:center;gap:10px}
.avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--leaf),var(--moss));display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;color:#fff;border:2px solid rgba(149,213,178,.3)}
.user-name{font-size:13px;font-weight:500;color:#fff}
.user-role{font-size:11px;color:var(--mint)}

main{flex:1;padding:40px;max-width:1100px;margin:0 auto;width:100%}
.page-header{margin-bottom:36px;display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:16px}
.page-title{font-family:'DM Serif Display',serif;font-size:36px;color:var(--forest);line-height:1.1}
.page-title span{display:block;font-size:14px;font-family:'DM Sans',sans-serif;font-weight:400;color:var(--stone);letter-spacing:.06em;text-transform:uppercase;margin-bottom:4px}

.balance-bar{display:flex;gap:12px;flex-wrap:wrap}
.balance-pill{background:#fff;border:1.5px solid var(--mist);border-radius:12px;padding:10px 18px;text-align:center;min-width:100px;box-shadow:0 2px 8px rgba(26,58,42,.06)}
.balance-pill .num{font-family:'DM Serif Display',serif;font-size:28px;color:var(--moss);line-height:1}
.balance-pill .num.warn{color:var(--amber)}
.balance-pill .lbl{font-size:11px;color:var(--stone);text-transform:uppercase;letter-spacing:.08em;margin-top:3px;font-weight:500}

.grid{display:grid;grid-template-columns:1fr 340px;gap:24px;align-items:start}
.sidebar{display:flex;flex-direction:column;gap:16px}

.card{background:#fff;border-radius:20px;border:1.5px solid rgba(216,243,220,.8);box-shadow:0 4px 24px rgba(26,58,42,.07);overflow:hidden}
.card-header{padding:22px 28px 18px;border-bottom:1.5px solid var(--mist);display:flex;align-items:center;gap:10px}
.card-icon{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px}
.card-icon.g{background:var(--mist)}
.card-icon.a{background:var(--amber-lt)}
.card-title{font-size:15px;font-weight:600;color:var(--forest)}
.card-body{padding:24px 28px}

.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
.form-row.full{grid-template-columns:1fr}
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-size:12px;font-weight:600;color:var(--moss);text-transform:uppercase;letter-spacing:.07em}
.field label .req{color:var(--error);margin-left:2px}
.field input,.field select,.field textarea{font-family:'DM Sans',sans-serif;font-size:14px;color:var(--ink);background:var(--cream);border:1.5px solid #e5e5e0;border-radius:10px;padding:10px 14px;outline:none;transition:border-color .2s,box-shadow .2s;width:100%}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--leaf);background:#fff;box-shadow:0 0 0 3px rgba(82,183,136,.12)}
.field input.error{border-color:var(--error);background:var(--error-lt)}
.field textarea{resize:vertical;min-height:80px}
.field select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232d6a4f' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px}
.field-hint{font-size:11px;color:var(--stone);margin-top:2px}
.field-err{font-size:11px;color:var(--error);margin-top:2px;display:none}
.has-error .field-err{display:block}

.days-preview{background:var(--mist);border-radius:10px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;opacity:0;transition:opacity .3s}
.days-preview.show{opacity:1}
.dp-label{font-size:13px;color:var(--moss);font-weight:500}
.dp-count{font-family:'DM Serif Display',serif;font-size:24px;color:var(--forest)}
.dp-count.over{color:var(--error)}

.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.type-opt{border:1.5px solid #e5e5e0;border-radius:12px;padding:12px 14px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:10px;background:var(--cream)}
.type-opt:hover{border-color:var(--mint);background:#fff}
.type-opt.active{border-color:var(--leaf);background:#fff;box-shadow:0 0 0 3px rgba(82,183,136,.12)}
.type-opt input[type=radio]{display:none}
.type-dot{width:18px;height:18px;border-radius:50%;border:2px solid #ccc;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.type-opt.active .type-dot{border-color:var(--leaf);background:var(--leaf)}
.type-opt.active .type-dot::after{content:'';width:6px;height:6px;border-radius:50%;background:#fff}
.type-label{font-size:13px;font-weight:500;color:var(--ink)}
.type-sub{font-size:11px;color:var(--stone)}

.btn-submit{width:100%;background:linear-gradient(135deg,var(--moss),var(--forest));color:#fff;border:none;border-radius:12px;padding:14px 24px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;margin-top:20px;letter-spacing:.02em;box-shadow:0 4px 14px rgba(45,106,79,.3)}
.btn-submit:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(45,106,79,.4)}
.divider{height:1px;background:var(--mist);margin:20px 0}
.policy-box{background:linear-gradient(135deg,var(--mist),rgba(216,243,220,.4));border:1.5px solid var(--mint);border-radius:12px;padding:14px 16px;font-size:12px;color:var(--moss);line-height:1.7;margin-bottom:16px}
.policy-box strong{color:var(--forest)}

.mini-cal{padding:20px 22px 16px}
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.cal-month{font-family:'DM Serif Display',serif;font-size:17px;color:var(--forest)}
.cal-btn{width:28px;height:28px;border-radius:7px;border:1.5px solid var(--mist);background:var(--cream);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--moss);font-size:14px;transition:all .15s}
.cal-btn:hover{background:var(--mist);border-color:var(--leaf)}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.cal-dow{font-size:10px;font-weight:600;color:var(--stone);text-align:center;padding:4px 0;text-transform:uppercase;letter-spacing:.05em}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:12px;border-radius:6px;cursor:pointer;transition:all .15s;color:var(--ink)}
.cal-day:hover:not(.empty):not(.other-month):not(.past){background:var(--mist);color:var(--moss)}
.cal-day.other-month{color:#ccc;cursor:default}
.cal-day.today{font-weight:700;color:var(--moss)}
.cal-day.in-range{background:var(--mist);border-radius:0;color:var(--moss)}
.cal-day.range-start{background:var(--moss);color:#fff;font-weight:600;border-radius:6px 0 0 6px}
.cal-day.range-end{background:var(--moss);color:#fff;font-weight:600;border-radius:0 6px 6px 0}
.cal-day.range-start.range-end{border-radius:6px}
.cal-day.past{color:#d1d5db;cursor:default;pointer-events:none}
.cal-day.festivo{color:var(--amber);font-weight:600}
.cal-legend{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;padding-top:14px;border-top:1px solid var(--mist)}
.cal-legend-item{display:flex;align-items:center;gap:5px;font-size:10px;color:var(--stone)}
.cal-legend-dot{width:8px;height:8px;border-radius:2px}

.req-list{display:flex;flex-direction:column;gap:10px}
.req-item{border:1.5px solid var(--mist);border-radius:12px;padding:12px 14px;display:flex;align-items:center;gap:12px}
.req-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.req-dot.aprobada{background:var(--success)}
.req-dot.pendiente{background:var(--amber)}
.req-dot.rechazada{background:var(--error)}
.req-info{flex:1;min-width:0}
.req-dates{font-size:13px;font-weight:500;color:var(--ink)}
.req-meta{font-size:11px;color:var(--stone)}
.req-badge{font-size:10px;font-weight:600;padding:3px 8px;border-radius:20px;text-transform:uppercase;letter-spacing:.05em;flex-shrink:0}
.req-badge.aprobada{background:var(--success-lt);color:var(--success)}
.req-badge.pendiente{background:var(--amber-lt);color:var(--amber)}
.req-badge.rechazada{background:var(--error-lt);color:var(--error)}

.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--forest);color:#fff;padding:14px 24px;border-radius:14px;font-size:14px;font-weight:500;box-shadow:0 8px 30px rgba(26,58,42,.35);z-index:1000;display:flex;align-items:center;gap:10px;transition:transform .4s cubic-bezier(.34,1.56,.64,1);min-width:280px}
.toast.show{transform:translateX(-50%) translateY(0)}

.success-overlay{display:none;position:fixed;inset:0;z-index:500;background:rgba(245,240,232,.95);align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.success-overlay.show{display:flex}
.success-card{background:#fff;border-radius:24px;padding:48px 56px;text-align:center;max-width:420px;box-shadow:0 20px 60px rgba(26,58,42,.18);border:1.5px solid var(--mist);animation:pop .5s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{from{transform:scale(.7);opacity:0}to{transform:scale(1);opacity:1}}
.success-icon{font-size:56px;margin-bottom:16px}
.success-title{font-family:'DM Serif Display',serif;font-size:28px;color:var(--forest);margin-bottom:10px}
.success-sub{font-size:14px;color:var(--stone);line-height:1.6;margin-bottom:24px}
.success-detail{background:var(--mist);border-radius:12px;padding:14px 20px;text-align:left;margin-bottom:24px;font-size:13px;color:var(--moss);line-height:1.8}
.btn-back{background:var(--moss);color:#fff;border:none;border-radius:12px;padding:12px 28px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s}
.btn-back:hover{background:var(--forest);transform:translateY(-1px)}

@media(max-width:860px){
  main{padding:24px 20px 48px}
  .grid{grid-template-columns:1fr}
  .form-row{grid-template-columns:1fr}
  header{padding:0 20px}
  .page-header{flex-direction:column;align-items:flex-start}
  .type-grid{grid-template-columns:1fr}
  .login-left{display:none}
  .login-right{width:100%;padding:40px 28px}
}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-left">
    <svg class="ll-leaf a" viewBox="0 0 200 300" fill="white"><path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/></svg>
    <svg class="ll-leaf b" viewBox="0 0 200 300" fill="white"><path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/></svg>
    <div class="login-brand">
      <div class="login-brand-mark">&#127807;</div>
      <div>
        <div class="login-brand-name">Frondoso</div>
        <div class="login-brand-tag">Portal del Empleado</div>
      </div>
    </div>
    <div class="login-headline">Tu espacio<br>de trabajo,<br><em>a tu medida.</em></div>
    <div class="login-sub">Gestiona tus vacaciones, consulta tu equipo y accede a todos los recursos de Frondoso desde un solo lugar.</div>
    <div class="login-feats">
      <div class="login-feat"><div class="login-feat-icon">&#127958;</div><span>Solicita y gestiona tus vacaciones en segundos</span></div>
      <div class="login-feat"><div class="login-feat-icon">&#128197;</div><span>Consulta el calendario del equipo en tiempo real</span></div>
      <div class="login-feat"><div class="login-feat-icon">&#127807;</div><span>Integrado con Microsoft 365 y Teams</span></div>
    </div>
  </div>

  <div class="login-right">
    <div class="login-title">Bienvenido/a</div>
    <div class="login-subtitle">Accede con tu cuenta de Frondoso</div>

    <div class="login-err-box" id="loginErrBox">
      <span>&#9888;</span>
      <span id="loginErrTxt">Usuario o contrasena incorrectos.</span>
    </div>

    <div class="lfield">
      <label>Usuario</label>
      <input type="text" id="loginUser" placeholder="tu nombre de usuario" autocomplete="username">
    </div>
    <div class="lfield">
      <label>Contrasena</label>
      <input type="password" id="loginPass" placeholder="&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;" autocomplete="current-password">
    </div>

    <label class="login-remember">
      <input type="checkbox" id="loginRemember" checked>
      <span>Mantener sesion iniciada</span>
    </label>

    <button class="btn-login" id="btnLogin">
      <div class="btn-spin"></div>
      <span class="btn-txt">Entrar al portal</span>
    </button>

    <div class="login-hint">
      <p>Acceso rapido:</p>
      <div class="demo-chips">
        <div class="chip" id="chipMagda">Magda</div>
        <div class="chip" id="chipVictor">Victor</div>
        <div class="chip" id="chipCarlos">Carlos</div>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appWrapper">
  <header>
    <div class="logo">
      <div class="logo-mark">&#127807;</div>
      <div>
        <div class="logo-name">Frondoso</div>
        <div class="logo-sub">Portal del Empleado</div>
      </div>
    </div>
    <div class="header-user">
      <div style="text-align:right">
        <div class="user-name" id="userName">-</div>
        <div class="user-role" id="userRole">-</div>
      </div>
      <div class="avatar" id="userAvatar">-</div>
    </div>
  </header>

  <main>
    <div class="page-header">
      <div class="page-title">
        <span>Recursos Humanos</span>
        Solicitud de Vacaciones
      </div>
      <div class="balance-bar">
        <div class="balance-pill"><div class="num" id="diasTotal">23</div><div class="lbl">Dias totales</div></div>
        <div class="balance-pill"><div class="num" id="diasUsados">9</div><div class="lbl">Usados</div></div>
        <div class="balance-pill"><div class="num" id="diasDisp">14</div><div class="lbl">Disponibles</div></div>
        <div class="balance-pill"><div class="num warn" id="diasSolic">0</div><div class="lbl">Esta solicitud</div></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <div class="card-icon g">&#128203;</div>
          <div class="card-title">Nueva solicitud</div>
        </div>
        <div class="card-body">
          <div class="policy-box">
            <strong>&#128204; Recuerda:</strong> Las solicitudes deben enviarse con <strong>minimo 15 dias de antelacion</strong>.
            Tu responsable recibirá la peticion por <strong>Microsoft Teams</strong> y tendrá 48h para responder.
          </div>

          <div class="field" style="margin-bottom:16px">
            <label>Tipo de ausencia <span class="req">*</span></label>
            <div class="type-grid" id="typeGrid">
              <label class="type-opt active" id="opt0"><input type="radio" name="tipo" value="vacaciones" checked><div class="type-dot"></div><div><div class="type-label">&#127958; Vacaciones</div><div class="type-sub">Dias de descanso anuales</div></div></label>
              <label class="type-opt" id="opt1"><input type="radio" name="tipo" value="asuntos_propios"><div class="type-dot"></div><div><div class="type-label">&#128197; Asuntos propios</div><div class="type-sub">Gestiones personales</div></div></label>
              <label class="type-opt" id="opt2"><input type="radio" name="tipo" value="enfermedad"><div class="type-dot"></div><div><div class="type-label">&#129298; Baja medica</div><div class="type-sub">Requiere justificante</div></div></label>
              <label class="type-opt" id="opt3"><input type="radio" name="tipo" value="otro"><div class="type-dot"></div><div><div class="type-label">&#128206; Otro motivo</div><div class="type-sub">Especificar en comentarios</div></div></label>
            </div>
          </div>

          <div class="form-row">
            <div class="field" id="fieldDesde"><label>Fecha inicio <span class="req">*</span></label><input type="date" id="fechaDesde"><span class="field-err">Selecciona una fecha valida</span></div>
            <div class="field" id="fieldHasta"><label>Fecha fin <span class="req">*</span></label><input type="date" id="fechaHasta"><span class="field-err">La fecha fin debe ser posterior</span></div>
          </div>

          <div class="days-preview" id="daysPreview">
            <div><div class="dp-label">Dias laborables solicitados</div><div style="font-size:11px;color:var(--stone);margin-top:2px">Excluye fines de semana y festivos</div></div>
            <div class="dp-count" id="dpCount">0</div>
          </div>

          <div class="form-row full"><div class="field"><label>Comentario</label><textarea id="comentario" placeholder="Informacion adicional para tu manager..."></textarea></div></div>

          <div class="form-row full">
            <div class="field">
              <label>Quien te cubre</label>
              <select id="sustituto">
                <option value="">Sin sustituto designado</option>
                <option value="joan">Joan Ferrer (Director Ops)</option>
                <option value="marta">Marta Ibanez</option>
                <option value="sofia">Sofia Romero</option>
                <option value="otro">Otro (especificar en comentario)</option>
              </select>
              <span class="field-hint">Recomendado para ausencias de mas de 3 dias</span>
            </div>
          </div>

          <div class="divider"></div>
          <div style="display:flex;align-items:center;gap:10px;font-size:13px;color:var(--stone)">
            <span style="font-size:16px">&#128232;</span>
            <span>La solicitud se enviara a <strong style="color:var(--moss)">Joan Ferrer</strong> via Microsoft Teams.</span>
          </div>
          <button class="btn-submit" id="btnSubmit">&#127807; Enviar solicitud</button>
        </div>
      </div>

      <div class="sidebar">
        <div class="card">
          <div class="card-header"><div class="card-icon g">&#128198;</div><div class="card-title">Calendario</div></div>
          <div class="mini-cal">
            <div class="cal-nav">
              <button class="cal-btn" id="btnPrev">&#8249;</button>
              <div class="cal-month" id="calMonth">-</div>
              <button class="cal-btn" id="btnNext">&#8250;</button>
            </div>
            <div class="cal-grid" id="calGrid"></div>
            <div class="cal-legend">
              <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--moss)"></div>Seleccionado</div>
              <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--mist);border:1px solid var(--mint)"></div>Rango</div>
              <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--amber-lt);border:1px solid var(--amber)"></div>Festivo</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><div class="card-icon a">&#128193;</div><div class="card-title">Mis solicitudes 2025</div></div>
          <div class="card-body" style="padding-top:16px"><div class="req-list" id="reqList"></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- SUCCESS -->
<div class="success-overlay" id="successOverlay">
  <div class="success-card">
    <div class="success-icon">&#127807;</div>
    <div class="success-title">Solicitud enviada</div>
    <div class="success-sub">Joan Ferrer recibira tu peticion por Teams y te respondera en un maximo de 48 horas.</div>
    <div class="success-detail" id="successDetail"></div>
    <button class="btn-back" id="btnBack">Volver al formulario</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="toastMsg"></span></div>

<script data-cfasync="false">
var FESTIVOS = ['2025-01-01','2025-01-06','2025-04-18','2025-04-21','2025-05-01','2025-06-09','2025-06-24','2025-08-15','2025-09-11','2025-09-24','2025-10-12','2025-11-01','2025-12-08','2025-12-25','2025-12-26'];
var MONTHS = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
var DOWS = ['Lu','Ma','Mi','Ju','Vi','Sa','Do'];
var USERS = {
  'magda':  {pass:'frondoso2025', name:'Magda Vilanova',  role:'Disenadora de Jardines', initials:'MV'},
  'victor': {pass:'frondoso2025', name:'Victor Pla',      role:'Tecnico de Instalacion', initials:'VP'},
  'carlos': {pass:'frondoso2025', name:'Carlos Mendoza',  role:'Project Manager',        initials:'CM'},
  'joan':   {pass:'frondoso2025', name:'Joan Ferrer',     role:'Director de Operaciones',initials:'JF'},
  'laia':   {pass:'frondoso2025', name:'Laia Camps',      role:'Responsable RRHH',       initials:'LC'}
};
var PREV_REQUESTS = [
  {desde:'2025-03-17',hasta:'2025-03-21',dias:5,tipo:'Vacaciones',estado:'aprobada'},
  {desde:'2025-05-29',hasta:'2025-06-02',dias:4,tipo:'Vacaciones',estado:'aprobada'},
  {desde:'2025-07-21',hasta:'2025-07-25',dias:5,tipo:'Vacaciones',estado:'pendiente'}
];
var calYear = new Date().getFullYear();
var calMonth = new Date().getMonth();
var selectedTipo = 'vacaciones';
var diasDisponibles = 14;
var toastTimer;

function isFestivo(d) { return FESTIVOS.indexOf(d.toISOString().split('T')[0]) !== -1; }
function isWeekday(d) { var day = d.getDay(); return day !== 0 && day !== 6; }
function workingDays(from, to) {
  var count = 0, cur = new Date(from);
  while (cur <= to) { if (isWeekday(cur) && !isFestivo(cur)) count++; cur.setDate(cur.getDate()+1); }
  return count;
}

function showToast(msg) {
  var t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(function(){ t.classList.remove('show'); }, 3000);
}

function setType(idx, val) {
  selectedTipo = val;
  for (var i=0; i<4; i++) {
    var el = document.getElementById('opt'+i);
    if (el) { if (i===idx) el.classList.add('active'); else el.classList.remove('active'); }
  }
}

function calcDays() {
  var desde = document.getElementById('fechaDesde').value;
  var hasta  = document.getElementById('fechaHasta').value;
  var preview = document.getElementById('daysPreview');
  var count = document.getElementById('dpCount');
  var solic = document.getElementById('diasSolic');
  if (!desde || !hasta) { preview.classList.remove('show'); solic.textContent='0'; return; }
  var d = new Date(desde+'T12:00:00'), h = new Date(hasta+'T12:00:00');
  if (h < d) { document.getElementById('fieldHasta').classList.add('has-error'); preview.classList.remove('show'); return; }
  document.getElementById('fieldHasta').classList.remove('has-error');
  var dias = workingDays(d, h);
  count.textContent = dias + (dias===1?' dia':' dias');
  count.className = 'dp-count' + (dias > diasDisponibles ? ' over' : '');
  solic.textContent = dias;
  solic.style.color = dias > diasDisponibles ? 'var(--error)' : 'var(--amber)';
  preview.classList.add('show');
  calYear = d.getFullYear(); calMonth = d.getMonth();
  renderCalendar();
}

function renderCalendar() {
  document.getElementById('calMonth').textContent = MONTHS[calMonth] + ' ' + calYear;
  var grid = document.getElementById('calGrid');
  grid.innerHTML = '';
  DOWS.forEach(function(d){ var el=document.createElement('div'); el.className='cal-dow'; el.textContent=d; grid.appendChild(el); });
  var desde = document.getElementById('fechaDesde') ? document.getElementById('fechaDesde').value : '';
  var hasta  = document.getElementById('fechaHasta') ? document.getElementById('fechaHasta').value  : '';
  var rangeStart = desde ? new Date(desde+'T12:00:00') : null;
  var rangeEnd   = hasta  ? new Date(hasta +'T12:00:00') : null;
  var firstDay = new Date(calYear, calMonth, 1);
  var lastDay  = new Date(calYear, calMonth+1, 0);
  var today = new Date(); today.setHours(12,0,0,0);
  var startDow = firstDay.getDay(); startDow = startDow===0 ? 6 : startDow-1;
  for (var i=0; i<startDow; i++) { var e=document.createElement('div'); e.className='cal-day empty'; grid.appendChild(e); }
  for (var day=1; day<=lastDay.getDate(); day++) {
    var date = new Date(calYear, calMonth, day, 12);
    var el = document.createElement('div');
    el.textContent = day;
    var cls = 'cal-day';
    if (date < today && date.toDateString()!==today.toDateString()) cls += ' past';
    if (date.toDateString()===today.toDateString()) cls += ' today';
    if (date.getDay()===0||date.getDay()===6) cls += ' weekend';
    if (isFestivo(date)) cls += ' festivo';
    if (rangeStart && rangeEnd) {
      if (date.toDateString()===rangeStart.toDateString()) cls += ' range-start';
      if (date.toDateString()===rangeEnd.toDateString()) cls += ' range-end';
      if (date > rangeStart && date < rangeEnd) cls += ' in-range';
    } else if (rangeStart && date.toDateString()===rangeStart.toDateString()) { cls += ' range-start range-end'; }
    el.className = cls;
    (function(d2, dayEl){
      if (cls.indexOf('past') === -1) {
        dayEl.addEventListener('click', function(){
          var s = calYear+'-'+String(calMonth+1).padStart(2,'0')+'-'+String(d2).padStart(2,'0');
          var fd = document.getElementById('fechaDesde'), fh = document.getElementById('fechaHasta');
          if (!fd.value || (fd.value && fh.value)) { fd.value=s; fh.value=''; }
          else { if (new Date(s+'T12:00:00') < new Date(fd.value+'T12:00:00')) fd.value=s; else fh.value=s; }
          calcDays();
        });
      }
    })(day, el);
    grid.appendChild(el);
  }
}

function renderRequests() {
  var list = document.getElementById('reqList');
  list.innerHTML = PREV_REQUESTS.map(function(r){
    var d = new Date(r.desde+'T12:00:00'), h = new Date(r.hasta+'T12:00:00');
    var fmt = function(dt){ return dt.toLocaleDateString('es-ES',{day:'numeric',month:'short'}); };
    return '<div class="req-item"><div class="req-dot '+r.estado+'"></div><div class="req-info"><div class="req-dates">'+fmt(d)+' - '+fmt(h)+'</div><div class="req-meta">'+r.dias+' dias · '+r.tipo+'</div></div><span class="req-badge '+r.estado+'">'+r.estado+'</span></div>';
  }).join('');
}

function submitForm() {
  var desde = document.getElementById('fechaDesde').value;
  var hasta  = document.getElementById('fechaHasta').value;
  var valid = true;
  document.getElementById('fieldDesde').classList.remove('has-error');
  document.getElementById('fieldHasta').classList.remove('has-error');
  if (!desde) { document.getElementById('fieldDesde').classList.add('has-error'); valid=false; }
  if (!hasta)  { document.getElementById('fieldHasta').classList.add('has-error');  valid=false; }
  if (desde && hasta && new Date(hasta) < new Date(desde)) { document.getElementById('fieldHasta').classList.add('has-error'); valid=false; }
  if (!valid) { showToast('Revisa las fechas'); return; }
  var d = new Date(desde+'T12:00:00'), h = new Date(hasta+'T12:00:00');
  var dias = workingDays(d, h);
  var fmt = function(dt){ return dt.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long'}); };
  var tipos = {vacaciones:'Vacaciones',asuntos_propios:'Asuntos propios',enfermedad:'Baja medica',otro:'Otro'};
  var nRef = 'FRO-' + (Math.floor(Math.random()*9000)+1000);
  document.getElementById('successDetail').innerHTML = '<strong>Ref:</strong> '+nRef+'<br><strong>Tipo:</strong> '+tipos[selectedTipo]+'<br><strong>Inicio:</strong> '+fmt(d)+'<br><strong>Fin:</strong> '+fmt(h)+'<br><strong>Dias:</strong> '+dias;
  PREV_REQUESTS.push({desde:desde,hasta:hasta,dias:dias,tipo:tipos[selectedTipo],estado:'pendiente'});
  renderRequests();
  var disp = parseInt(document.getElementById('diasDisp').textContent);
  var usados = parseInt(document.getElementById('diasUsados').textContent);
  document.getElementById('diasDisp').textContent = Math.max(0, disp-dias);
  document.getElementById('diasUsados').textContent = usados+dias;
  diasDisponibles = Math.max(0, disp-dias);
  document.getElementById('successOverlay').classList.add('show');
}

function resetForm() {
  document.getElementById('successOverlay').classList.remove('show');
  document.getElementById('fechaDesde').value = '';
  document.getElementById('fechaHasta').value = '';
  document.getElementById('comentario').value = '';
  document.getElementById('sustituto').selectedIndex = 0;
  document.getElementById('daysPreview').classList.remove('show');
  document.getElementById('diasSolic').textContent = '0';
  setType(0,'vacaciones');
  renderCalendar();
}

function doLogin() {
  var user = document.getElementById('loginUser').value.trim().toLowerCase();
  var pass  = document.getElementById('loginPass').value;
  var btn   = document.getElementById('btnLogin');
  var errBox = document.getElementById('loginErrBox');
  var errTxt = document.getElementById('loginErrTxt');
  errBox.classList.remove('show');
  document.getElementById('loginUser').classList.remove('err');
  document.getElementById('loginPass').classList.remove('err');
  if (!user) { document.getElementById('loginUser').classList.add('err'); errTxt.textContent='Introduce tu usuario.'; errBox.classList.add('show'); return; }
  if (!pass) { document.getElementById('loginPass').classList.add('err'); errTxt.textContent='Introduce tu contrasena.'; errBox.classList.add('show'); return; }
  btn.classList.add('loading'); btn.disabled = true;
  setTimeout(function(){
    var u = USERS[user];
    if (!u || u.pass !== pass) {
      btn.classList.remove('loading'); btn.disabled=false;
      document.getElementById('loginUser').classList.add('err');
      document.getElementById('loginPass').classList.add('err');
      errTxt.textContent = 'Usuario o contrasena incorrectos.';
      errBox.classList.add('show');
      document.getElementById('loginPass').value = '';
      return;
    }
    document.getElementById('userName').textContent = u.name;
    document.getElementById('userRole').textContent = u.role;
    document.getElementById('userAvatar').textContent = u.initials;
    document.getElementById('loginPage').classList.add('out');
    document.getElementById('appWrapper').style.display = 'flex';
    setTimeout(function(){ document.getElementById('loginPage').style.display='none'; }, 500);
    btn.classList.remove('loading'); btn.disabled=false;
    renderCalendar();
    renderRequests();
  }, 1200);
}

// Wire up events after DOM ready
document.addEventListener('DOMContentLoaded', function(){
  var today = new Date().toISOString().split('T')[0];
  document.getElementById('fechaDesde').min = today;
  document.getElementById('fechaHasta').min = today;
  document.getElementById('fechaDesde').addEventListener('change', calcDays);
  document.getElementById('fechaHasta').addEventListener('change', calcDays);
  document.getElementById('btnSubmit').addEventListener('click', submitForm);
  document.getElementById('btnBack').addEventListener('click', resetForm);
  document.getElementById('btnPrev').addEventListener('click', function(){ calMonth--; if(calMonth<0){calMonth=11;calYear--;} renderCalendar(); });
  document.getElementById('btnNext').addEventListener('click', function(){ calMonth++; if(calMonth>11){calMonth=0;calYear++;} renderCalendar(); });
  document.getElementById('btnLogin').addEventListener('click', doLogin);
  document.getElementById('loginUser').addEventListener('keydown', function(e){ if(e.key==='Enter') doLogin(); });
  document.getElementById('loginPass').addEventListener('keydown', function(e){ if(e.key==='Enter') doLogin(); });
  document.getElementById('chipMagda').addEventListener('click',  function(){ document.getElementById('loginUser').value='magda';  document.getElementById('loginPass').value='frondoso2025'; });
  document.getElementById('chipVictor').addEventListener('click', function(){ document.getElementById('loginUser').value='victor'; document.getElementById('loginPass').value='frondoso2025'; });
  document.getElementById('chipCarlos').addEventListener('click', function(){ document.getElementById('loginUser').value='carlos'; document.getElementById('loginPass').value='frondoso2025'; });
  document.getElementById('opt0').addEventListener('click', function(){ setType(0,'vacaciones'); });
  document.getElementById('opt1').addEventListener('click', function(){ setType(1,'asuntos_propios'); });
  document.getElementById('opt2').addEventListener('click', function(){ setType(2,'enfermedad'); });
  document.getElementById('opt3').addEventListener('click', function(){ setType(3,'otro'); });
});
</script>
</body>
</html>
