<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frondoso Â· Portal del Empleado</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --forest:   #1a3a2a;
    --moss:     #2d6a4f;
    --leaf:     #52b788;
    --mint:     #95d5b2;
    --mist:     #d8f3dc;
    --parchment:#f5f0e8;
    --cream:    #faf8f2;
    --ink:      #1c1c1c;
    --stone:    #6b7280;
    --amber:    #d97706;
    --amber-lt: #fef3c7;
    --error:    #dc2626;
    --error-lt: #fef2f2;
    --success:  #059669;
    --success-lt:#ecfdf5;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    color: var(--ink);
    position: relative;
    overflow-x: hidden;
  }

  /* Organic background texture */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 10% 20%, rgba(82,183,136,0.07) 0%, transparent 60%),
      radial-gradient(ellipse 60% 80% at 90% 80%, rgba(45,106,79,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 40% 40% at 50% 50%, rgba(149,213,178,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  /* Decorative leaf shapes */
  .leaf-bg {
    position: fixed;
    pointer-events: none;
    z-index: 0;
    opacity: 0.035;
  }
  .leaf-bg.tl { top: -60px; left: -40px; width: 320px; transform: rotate(-20deg); }
  .leaf-bg.br { bottom: -80px; right: -60px; width: 400px; transform: rotate(160deg); }

  /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    position: relative; z-index: 10;
    background: var(--forest);
    padding: 0 40px;
    display: flex; align-items: center; justify-content: space-between;
    height: 68px;
    box-shadow: 0 2px 20px rgba(26,58,42,0.25);
  }

  .logo {
    display: flex; align-items: center; gap: 12px;
    text-decoration: none;
  }
  .logo-mark {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--leaf), var(--mint));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .logo-text {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    color: white;
    letter-spacing: 0.02em;
  }
  .logo-sub {
    font-size: 11px;
    color: var(--mint);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-weight: 500;
    margin-top: 1px;
  }

  .header-user {
    display: flex; align-items: center; gap: 10px;
  }
  .avatar {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--leaf), var(--moss));
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 600; color: white;
    border: 2px solid rgba(149,213,178,0.3);
  }
  .user-info { text-align: right; }
  .user-name { font-size: 13px; font-weight: 500; color: white; }
  .user-role { font-size: 11px; color: var(--mint); }

  /* â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  main {
    flex: 1;
    position: relative; z-index: 1;
    padding: 40px 40px 60px;
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
  }

  /* â”€â”€ PAGE TITLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .page-header {
    margin-bottom: 36px;
    display: flex; align-items: flex-end; justify-content: space-between;
    flex-wrap: wrap; gap: 16px;
  }
  .page-title {
    font-family: 'DM Serif Display', serif;
    font-size: 36px;
    color: var(--forest);
    line-height: 1.1;
  }
  .page-title span {
    display: block;
    font-size: 14px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 400;
    color: var(--stone);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  /* Balance pill */
  .balance-bar {
    display: flex; gap: 12px; flex-wrap: wrap;
  }
  .balance-pill {
    background: white;
    border: 1.5px solid var(--mist);
    border-radius: 12px;
    padding: 10px 18px;
    text-align: center;
    min-width: 100px;
    box-shadow: 0 2px 8px rgba(26,58,42,0.06);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .balance-pill:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(26,58,42,0.1); }
  .balance-pill .num {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    color: var(--moss);
    line-height: 1;
  }
  .balance-pill .num.warn { color: var(--amber); }
  .balance-pill .lbl {
    font-size: 11px;
    color: var(--stone);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 3px;
    font-weight: 500;
  }

  /* â”€â”€ GRID LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 24px;
    align-items: start;
  }

  /* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: white;
    border-radius: 20px;
    border: 1.5px solid rgba(216,243,220,0.8);
    box-shadow: 0 4px 24px rgba(26,58,42,0.07);
    overflow: hidden;
  }
  .card-header {
    padding: 22px 28px 18px;
    border-bottom: 1.5px solid var(--mist);
    display: flex; align-items: center; gap: 10px;
  }
  .card-icon {
    width: 34px; height: 34px; border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .card-icon.green { background: var(--mist); }
  .card-icon.amber { background: var(--amber-lt); }
  .card-title {
    font-size: 15px; font-weight: 600; color: var(--forest);
  }
  .card-body { padding: 24px 28px; }

  /* â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }
  .form-row.full { grid-template-columns: 1fr; }

  .field {
    display: flex; flex-direction: column; gap: 6px;
  }
  .field label {
    font-size: 12px; font-weight: 600;
    color: var(--moss);
    text-transform: uppercase;
    letter-spacing: 0.07em;
  }
  .field label .req { color: var(--error); margin-left: 2px; }

  .field input,
  .field select,
  .field textarea {
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    color: var(--ink);
    background: var(--cream);
    border: 1.5px solid #e5e5e0;
    border-radius: 10px;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
    width: 100%;
  }
  .field input:focus,
  .field select:focus,
  .field textarea:focus {
    border-color: var(--leaf);
    background: white;
    box-shadow: 0 0 0 3px rgba(82,183,136,0.12);
  }
  .field input.error { border-color: var(--error); background: var(--error-lt); }
  .field textarea { resize: vertical; min-height: 80px; }
  .field select { cursor: pointer; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232d6a4f' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    padding-right: 36px;
  }
  .field-hint { font-size: 11px; color: var(--stone); margin-top: 2px; }
  .field-error { font-size: 11px; color: var(--error); margin-top: 2px; display: none; }
  .field.has-error .field-error { display: block; }

  /* Date computed display */
  .days-preview {
    background: var(--mist);
    border-radius: 10px;
    padding: 12px 16px;
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .days-preview.visible { opacity: 1; }
  .days-preview .dp-label { font-size: 13px; color: var(--moss); font-weight: 500; }
  .days-preview .dp-count {
    font-family: 'DM Serif Display', serif;
    font-size: 24px; color: var(--forest);
  }
  .days-preview .dp-count.over { color: var(--error); }

  /* Tipo selector */
  .type-grid {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; margin-bottom: 16px;
  }
  .type-opt {
    border: 1.5px solid #e5e5e0;
    border-radius: 12px;
    padding: 12px 14px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 10px;
    background: var(--cream);
  }
  .type-opt:hover { border-color: var(--mint); background: white; }
  .type-opt.active {
    border-color: var(--leaf);
    background: white;
    box-shadow: 0 0 0 3px rgba(82,183,136,0.12);
  }
  .type-opt input[type="radio"] { display: none; }
  .type-dot {
    width: 18px; height: 18px; border-radius: 50%;
    border: 2px solid #ccc;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: all 0.2s;
  }
  .type-opt.active .type-dot {
    border-color: var(--leaf); background: var(--leaf);
  }
  .type-opt.active .type-dot::after {
    content: ''; width: 6px; height: 6px;
    border-radius: 50%; background: white;
  }
  .type-label { font-size: 13px; font-weight: 500; color: var(--ink); }
  .type-sub { font-size: 11px; color: var(--stone); }

  /* Submit button */
  .btn-submit {
    width: 100%;
    background: linear-gradient(135deg, var(--moss), var(--forest));
    color: white;
    border: none;
    border-radius: 12px;
    padding: 14px 24px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px; font-weight: 600;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: all 0.2s;
    margin-top: 20px;
    letter-spacing: 0.02em;
    box-shadow: 0 4px 14px rgba(45,106,79,0.3);
  }
  .btn-submit:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(45,106,79,0.4);
  }
  .btn-submit:active { transform: translateY(0); }
  .btn-submit:disabled {
    background: #ccc; box-shadow: none;
    cursor: not-allowed; transform: none;
  }

  /* â”€â”€ SIDEBAR PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sidebar { display: flex; flex-direction: column; gap: 16px; }

  /* Calendar widget */
  .mini-cal {
    padding: 20px 22px 16px;
  }
  .cal-nav {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 14px;
  }
  .cal-month {
    font-family: 'DM Serif Display', serif;
    font-size: 17px; color: var(--forest);
  }
  .cal-btn {
    width: 28px; height: 28px; border-radius: 7px;
    border: 1.5px solid var(--mist); background: var(--cream);
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    color: var(--moss); font-size: 14px;
    transition: all 0.15s;
  }
  .cal-btn:hover { background: var(--mist); border-color: var(--leaf); }
  .cal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 2px; }
  .cal-dow {
    font-size: 10px; font-weight: 600; color: var(--stone);
    text-align: center; padding: 4px 0;
    text-transform: uppercase; letter-spacing: 0.05em;
  }
  .cal-day {
    aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
    font-size: 12px; border-radius: 6px;
    cursor: pointer; transition: all 0.15s; color: var(--ink);
    font-weight: 400;
  }
  .cal-day:hover:not(.empty):not(.other-month) { background: var(--mist); color: var(--moss); }
  .cal-day.other-month { color: #ccc; cursor: default; }
  .cal-day.today { font-weight: 700; color: var(--moss); }
  .cal-day.today::after {
    content: ''; position: absolute;
    bottom: 3px; left: 50%; transform: translateX(-50%);
    width: 4px; height: 4px; border-radius: 50%;
    background: var(--leaf);
  }
  .cal-day.today { position: relative; }
  .cal-day.in-range {
    background: var(--mist);
    border-radius: 0; color: var(--moss);
  }
  .cal-day.range-start, .cal-day.range-end {
    background: var(--moss); color: white; font-weight: 600;
    border-radius: 6px;
  }
  .cal-day.range-start { border-radius: 6px 0 0 6px; }
  .cal-day.range-end { border-radius: 0 6px 6px 0; }
  .cal-day.range-start.range-end { border-radius: 6px; }
  .cal-day.weekend { color: var(--stone); }
  .cal-day.past { color: #d1d5db; cursor: default; pointer-events: none; }
  .cal-day.festivo { color: var(--amber); font-weight: 600; }
  .cal-day.festivo.in-range { color: var(--amber); }

  .cal-legend {
    display: flex; gap: 12px; flex-wrap: wrap; margin-top: 14px;
    padding-top: 14px; border-top: 1px solid var(--mist);
  }
  .cal-legend-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 10px; color: var(--stone);
  }
  .cal-legend-dot {
    width: 8px; height: 8px; border-radius: 2px;
  }

  /* Requests history */
  .req-list { display: flex; flex-direction: column; gap: 10px; }
  .req-item {
    border: 1.5px solid var(--mist);
    border-radius: 12px;
    padding: 12px 14px;
    display: flex; align-items: center; gap: 12px;
    transition: box-shadow 0.2s;
  }
  .req-item:hover { box-shadow: 0 3px 10px rgba(26,58,42,0.07); }
  .req-status {
    width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
  }
  .req-status.aprobada { background: var(--success); }
  .req-status.pendiente { background: var(--amber); }
  .req-status.rechazada { background: var(--error); }
  .req-info { flex: 1; min-width: 0; }
  .req-dates { font-size: 13px; font-weight: 500; color: var(--ink); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .req-meta { font-size: 11px; color: var(--stone); }
  .req-badge {
    font-size: 10px; font-weight: 600; padding: 3px 8px;
    border-radius: 20px; white-space: nowrap; flex-shrink: 0;
    text-transform: uppercase; letter-spacing: 0.05em;
  }
  .req-badge.aprobada { background: var(--success-lt); color: var(--success); }
  .req-badge.pendiente { background: var(--amber-lt); color: var(--amber); }
  .req-badge.rechazada { background: var(--error-lt); color: var(--error); }

  /* â”€â”€ TOAST NOTIFICATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .toast {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
    background: var(--forest); color: white;
    padding: 14px 24px; border-radius: 14px;
    font-size: 14px; font-weight: 500;
    box-shadow: 0 8px 30px rgba(26,58,42,0.35);
    z-index: 1000;
    display: flex; align-items: center; gap: 10px;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    min-width: 280px; max-width: 400px;
  }
  .toast.visible { transform: translateX(-50%) translateY(0); }
  .toast.error { background: #7f1d1d; }
  .toast-icon { font-size: 18px; flex-shrink: 0; }

  /* â”€â”€ SUCCESS STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .success-overlay {
    display: none;
    position: fixed; inset: 0; z-index: 500;
    background: rgba(245,240,232,0.95);
    align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
  }
  .success-overlay.visible { display: flex; }
  .success-card {
    background: white;
    border-radius: 24px;
    padding: 48px 56px;
    text-align: center;
    max-width: 420px;
    box-shadow: 0 20px 60px rgba(26,58,42,0.18);
    border: 1.5px solid var(--mist);
    animation: pop 0.5s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes pop { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .success-icon { font-size: 56px; margin-bottom: 16px; }
  .success-title {
    font-family: 'DM Serif Display', serif;
    font-size: 28px; color: var(--forest);
    margin-bottom: 10px;
  }
  .success-sub { font-size: 14px; color: var(--stone); line-height: 1.6; margin-bottom: 24px; }
  .success-detail {
    background: var(--mist); border-radius: 12px;
    padding: 14px 20px; text-align: left;
    margin-bottom: 24px;
    font-size: 13px; color: var(--moss);
    line-height: 1.8;
  }
  .btn-back {
    background: var(--moss); color: white;
    border: none; border-radius: 12px;
    padding: 12px 28px; font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-back:hover { background: var(--forest); transform: translateY(-1px); }

  /* â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .divider {
    height: 1px; background: var(--mist);
    margin: 20px 0;
  }

  /* â”€â”€ POLICY BOX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .policy-box {
    background: linear-gradient(135deg, var(--mist), rgba(216,243,220,0.4));
    border: 1.5px solid var(--mint);
    border-radius: 12px;
    padding: 14px 16px;
    font-size: 12px; color: var(--moss);
    line-height: 1.7;
    margin-bottom: 16px;
  }
  .policy-box strong { color: var(--forest); }

  @media (max-width: 860px) {
    main { padding: 24px 20px 48px; }
    .grid { grid-template-columns: 1fr; }
    .form-row { grid-template-columns: 1fr; }
    header { padding: 0 20px; }
    .page-header { flex-direction: column; align-items: flex-start; }
    .type-grid { grid-template-columns: 1fr; }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN PAGE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #loginPage {
    position: fixed; inset: 0; z-index: 9999;
    display: flex;
    background: var(--forest);
    overflow: hidden;
  }
  #loginPage.hidden {
    pointer-events: none;
    animation: loginExit 0.6s cubic-bezier(0.4,0,0.2,1) forwards;
  }
  @keyframes loginExit {
    to { opacity: 0; transform: scale(1.03); }
  }

  /* Split layout */
  .login-left {
    flex: 1;
    display: flex; flex-direction: column;
    justify-content: center; align-items: flex-start;
    padding: 60px 64px;
    position: relative;
    overflow: hidden;
  }
  .login-left::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 70% 50% at 20% 80%, rgba(82,183,136,0.18) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 80% 20%, rgba(149,213,178,0.10) 0%, transparent 60%);
    pointer-events: none;
  }
  .login-left-leaf {
    position: absolute; pointer-events: none; opacity: 0.06;
  }
  .login-left-leaf.one { bottom: -80px; left: -60px; width: 380px; transform: rotate(-30deg); }
  .login-left-leaf.two { top: -100px; right: -40px; width: 300px; transform: rotate(40deg); }

  .login-brand {
    display: flex; align-items: center; gap: 14px;
    margin-bottom: 56px; position: relative; z-index: 1;
  }
  .login-brand-mark {
    width: 48px; height: 48px; border-radius: 14px;
    background: linear-gradient(135deg, var(--leaf), var(--mint));
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    box-shadow: 0 8px 24px rgba(82,183,136,0.3);
  }
  .login-brand-name {
    font-family: 'DM Serif Display', serif;
    font-size: 28px; color: white;
  }
  .login-brand-tag {
    font-size: 12px; color: var(--mint);
    letter-spacing: 0.1em; text-transform: uppercase; font-weight: 500;
  }

  .login-headline {
    font-family: 'DM Serif Display', serif;
    font-size: 52px; line-height: 1.05;
    color: white;
    margin-bottom: 20px;
    position: relative; z-index: 1;
  }
  .login-headline em {
    font-style: italic; color: var(--mint);
  }
  .login-sub {
    font-size: 16px; color: rgba(255,255,255,0.55);
    line-height: 1.6; max-width: 360px;
    position: relative; z-index: 1;
    margin-bottom: 48px;
  }
  .login-features {
    display: flex; flex-direction: column; gap: 12px;
    position: relative; z-index: 1;
  }
  .login-feat {
    display: flex; align-items: center; gap: 12px;
    color: rgba(255,255,255,0.7); font-size: 14px;
  }
  .login-feat-dot {
    width: 28px; height: 28px; border-radius: 8px;
    background: rgba(82,183,136,0.15);
    border: 1px solid rgba(82,183,136,0.3);
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; flex-shrink: 0;
  }

  /* Right panel â€” form */
  .login-right {
    width: 440px; flex-shrink: 0;
    background: var(--cream);
    display: flex; flex-direction: column;
    justify-content: center;
    padding: 56px 48px;
    position: relative;
    box-shadow: -20px 0 60px rgba(0,0,0,0.2);
  }
  .login-right::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--leaf), var(--mint));
  }

  .login-form-title {
    font-family: 'DM Serif Display', serif;
    font-size: 30px; color: var(--forest);
    margin-bottom: 6px;
  }
  .login-form-sub {
    font-size: 14px; color: var(--stone);
    margin-bottom: 36px;
    line-height: 1.5;
  }

  .login-field {
    display: flex; flex-direction: column; gap: 6px;
    margin-bottom: 18px;
  }
  .login-field label {
    font-size: 12px; font-weight: 600;
    color: var(--moss);
    text-transform: uppercase; letter-spacing: 0.07em;
  }
  .login-field input {
    font-family: 'DM Sans', sans-serif;
    font-size: 14px; color: var(--ink);
    background: white;
    border: 1.5px solid #e5e5e0;
    border-radius: 10px;
    padding: 12px 16px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
  }
  .login-field input:focus {
    border-color: var(--leaf);
    box-shadow: 0 0 0 3px rgba(82,183,136,0.12);
  }
  .login-field input.login-error { border-color: var(--error); }

  .login-remember {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 24px; cursor: pointer;
  }
  .login-remember input[type="checkbox"] {
    width: 16px; height: 16px; accent-color: var(--moss); cursor: pointer;
  }
  .login-remember span { font-size: 13px; color: var(--stone); }

  .btn-login {
    width: 100%;
    background: linear-gradient(135deg, var(--moss), var(--forest));
    color: white; border: none; border-radius: 12px;
    padding: 14px; font-family: 'DM Sans', sans-serif;
    font-size: 15px; font-weight: 600;
    cursor: pointer; display: flex; align-items: center;
    justify-content: center; gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 4px 14px rgba(45,106,79,0.3);
    letter-spacing: 0.02em;
    position: relative; overflow: hidden;
  }
  .btn-login:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(45,106,79,0.4);
  }
  .btn-login:active { transform: translateY(0); }
  .btn-login .btn-loader {
    display: none; width: 18px; height: 18px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .btn-login.loading .btn-loader { display: block; }
  .btn-login.loading .btn-label { opacity: 0; }

  .login-error-msg {
    background: var(--error-lt);
    border: 1px solid rgba(220,38,38,0.2);
    border-radius: 10px; padding: 12px 14px;
    font-size: 13px; color: var(--error);
    margin-bottom: 18px; display: none;
    align-items: center; gap: 8px;
  }
  .login-error-msg.visible { display: flex; }

  .login-hint {
    margin-top: 20px; padding-top: 20px;
    border-top: 1px solid var(--mist);
    text-align: center;
  }
  .login-hint p { font-size: 12px; color: var(--stone); }
  .login-hint strong { color: var(--moss); }

  /* Credentials demo chips */
  .demo-creds {
    display: flex; gap: 8px; flex-wrap: wrap;
    justify-content: center; margin-top: 12px;
  }
  .demo-chip {
    background: var(--mist); border: 1px solid var(--mint);
    border-radius: 8px; padding: 6px 12px;
    font-size: 11px; color: var(--moss);
    cursor: pointer; transition: all 0.15s; font-weight: 500;
  }
  .demo-chip:hover { background: var(--leaf); color: white; border-color: var(--leaf); }

  /* App wrapper â€” hidden until login */
  #appWrapper {
    display: none;
    flex-direction: column;
    min-height: 100vh;
  }
  #appWrapper.visible { display: flex; }

  @media (max-width: 860px) {
    .login-left { display: none; }
    .login-right { width: 100%; padding: 40px 28px; }
  }

</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginPage" style="display:flex">

  <!-- Left: branding -->
  <div class="login-left">
    <svg class="login-left-leaf one" viewBox="0 0 200 300" fill="white">
      <path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/>
    </svg>
    <svg class="login-left-leaf two" viewBox="0 0 200 300" fill="white">
      <path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/>
    </svg>

    <div class="login-brand">
      <div class="login-brand-mark">ğŸŒ¿</div>
      <div>
        <div class="login-brand-name">Frondoso</div>
        <div class="login-brand-tag">Portal del Empleado</div>
      </div>
    </div>

    <div class="login-headline">
      Tu espacio<br>de trabajo,<br><em>a tu medida.</em>
    </div>
    <div class="login-sub">
      Gestiona tus vacaciones, consulta tu equipo y accede a todos los recursos de Frondoso desde un solo lugar.
    </div>
    <div class="login-features">
      <div class="login-feat">
        <div class="login-feat-dot">ğŸ–ï¸</div>
        <span>Solicita y gestiona tus vacaciones en segundos</span>
      </div>
      <div class="login-feat">
        <div class="login-feat-dot">ğŸ“…</div>
        <span>Consulta el calendario del equipo en tiempo real</span>
      </div>
      <div class="login-feat">
        <div class="login-feat-dot">ğŸŒ¿</div>
        <span>Integrado con Microsoft 365 y Teams</span>
      </div>
    </div>
  </div>

  <!-- Right: form -->
  <div class="login-right">
    <div class="login-form-title">Bienvenido/a</div>
    <div class="login-form-sub">Accede con tu cuenta corporativa de Frondoso</div>

    <div class="login-error-msg" id="loginErrorMsg">
      <span>âš ï¸</span>
      <span id="loginErrorText">Usuario o contraseÃ±a incorrectos. IntÃ©ntalo de nuevo.</span>
    </div>

    <div class="login-field">
      <label>Email corporativo</label>
      <input type="email" id="loginEmail" placeholder="nombre@frondoso.eu"
        onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <div class="login-field">
      <label>ContraseÃ±a</label>
      <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
        onkeydown="if(event.key==='Enter')doLogin()">
    </div>

    <label class="login-remember">
      <input type="checkbox" id="loginRemember" checked>
      <span>Mantener sesiÃ³n iniciada</span>
    </label>

    <button class="btn-login" id="btnLogin" onclick="doLogin()">
      <div class="btn-loader"></div>
      <span class="btn-label">Entrar al portal</span>
    </button>

    <div class="login-hint">
      <p>Â¿Primera vez? Usa tus credenciales de Microsoft 365.<br>Si tienes problemas de acceso, contacta con</p>
      <p><strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a5ccd1e5c3d7cacbc1cad6ca8bc0d0">[email&#160;protected]</a></strong></p>
      <div class="demo-creds">
        <div class="demo-chip" onclick="fillCreds('magda@frondoso.eu','frondoso2025')">ğŸ‘¤ Magda</div>
        <div class="demo-chip" onclick="fillCreds('victor.pla@frondoso.eu','frondoso2025')">ğŸ‘¤ VÃ­ctor</div>
        <div class="demo-chip" onclick="fillCreds('carlos.mendoza@frondoso.eu','frondoso2025')">ğŸ‘¤ Carlos</div>
        <div class="demo-chip" onclick="fillCreds('admin@frondoso.eu','wrong')">ğŸ’¥ Error</div>
      </div>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP WRAPPER (hidden until login)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appWrapper" style="display:none">

<!-- Decorative leaves -->
<svg class="leaf-bg tl" viewBox="0 0 200 300" fill="var(--forest)">
  <path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/>
</svg>
<svg class="leaf-bg br" viewBox="0 0 200 300" fill="var(--forest)">
  <path d="M100 0 C150 50 200 100 180 200 C160 280 80 300 40 260 C0 220 -20 140 20 80 C40 40 80 10 100 0Z"/>
</svg>

<!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <div class="logo">
    <div class="logo-mark">ğŸŒ¿</div>
    <div>
      <div class="logo-text">Frondoso</div>
      <div class="logo-sub">Portal del Empleado</div>
    </div>
  </div>
  <div class="header-user">
    <div class="user-info">
      <div class="user-name">Carlos Mendoza</div>
      <div class="user-role">Project Manager Â· Operaciones</div>
    </div>
    <div class="avatar">CM</div>
  </div>
</header>

<!-- â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>
  <div class="page-header">
    <div class="page-title">
      <span>Recursos Humanos</span>
      Solicitud de Vacaciones
    </div>
    <div class="balance-bar">
      <div class="balance-pill">
        <div class="num" id="diasTotal">23</div>
        <div class="lbl">DÃ­as totales</div>
      </div>
      <div class="balance-pill">
        <div class="num" id="diasUsados">9</div>
        <div class="lbl">Usados</div>
      </div>
      <div class="balance-pill">
        <div class="num" id="diasDisp">14</div>
        <div class="lbl">Disponibles</div>
      </div>
      <div class="balance-pill">
        <div class="num warn" id="diasSolic">0</div>
        <div class="lbl">Esta solicitud</div>
      </div>
    </div>
  </div>

  <div class="grid">

    <!-- â”€â”€ FORM CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon green">ğŸ“‹</div>
        <div>
          <div class="card-title">Nueva solicitud</div>
        </div>
      </div>
      <div class="card-body">

        <div class="policy-box">
          <strong>ğŸ“Œ Recuerda:</strong> Las solicitudes deben enviarse con <strong>mÃ­nimo 15 dÃ­as de antelaciÃ³n</strong>. 
          Tu responsable directo recibirÃ¡ la peticiÃ³n por <strong>Microsoft Teams</strong> y tendrÃ¡ 48h para responder.
        </div>

        <!-- Tipo de ausencia -->
        <div class="field" style="margin-bottom:16px;">
          <label>Tipo de ausencia <span class="req">*</span></label>
          <div class="type-grid" id="typeGrid">
            <label class="type-opt active" onclick="setType(this,'vacaciones')">
              <input type="radio" name="tipo" value="vacaciones" checked>
              <div class="type-dot"></div>
              <div>
                <div class="type-label">ğŸ–ï¸ Vacaciones</div>
                <div class="type-sub">DÃ­as de descanso anuales</div>
              </div>
            </label>
            <label class="type-opt" onclick="setType(this,'asuntos_propios')">
              <input type="radio" name="tipo" value="asuntos_propios">
              <div class="type-dot"></div>
              <div>
                <div class="type-label">ğŸ“… Asuntos propios</div>
                <div class="type-sub">Gestiones personales</div>
              </div>
            </label>
            <label class="type-opt" onclick="setType(this,'enfermedad')">
              <input type="radio" name="tipo" value="enfermedad">
              <div class="type-dot"></div>
              <div>
                <div class="type-label">ğŸ¤’ Baja mÃ©dica</div>
                <div class="type-sub">Requiere justificante</div>
              </div>
            </label>
            <label class="type-opt" onclick="setType(this,'otro')">
              <input type="radio" name="tipo" value="otro">
              <div class="type-dot"></div>
              <div>
                <div class="type-label">ğŸ“ Otro motivo</div>
                <div class="type-sub">Especificar en comentarios</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Fechas -->
        <div class="form-row">
          <div class="field" id="fieldDesde">
            <label>Fecha de inicio <span class="req">*</span></label>
            <input type="date" id="fechaDesde" min="" onchange="calcDays()">
            <span class="field-error" id="errDesde">Selecciona una fecha vÃ¡lida</span>
          </div>
          <div class="field" id="fieldHasta">
            <label>Fecha de fin <span class="req">*</span></label>
            <input type="date" id="fechaHasta" min="" onchange="calcDays()">
            <span class="field-error" id="errHasta">La fecha de fin debe ser posterior al inicio</span>
          </div>
        </div>

        <!-- Days preview -->
        <div class="days-preview" id="daysPreview">
          <div>
            <div class="dp-label">DÃ­as laborables solicitados</div>
            <div style="font-size:11px;color:var(--stone);margin-top:2px;">Excluye fines de semana y festivos</div>
          </div>
          <div class="dp-count" id="dpCount">â€”</div>
        </div>

        <!-- Comentario -->
        <div class="form-row full">
          <div class="field">
            <label>Comentario <span style="color:var(--stone);font-weight:400;text-transform:none;letter-spacing:0">(opcional)</span></label>
            <textarea id="comentario" placeholder="AÃ±ade cualquier informaciÃ³n relevante para tu manager..."></textarea>
          </div>
        </div>

        <!-- Quien cubre -->
        <div class="form-row full">
          <div class="field">
            <label>Â¿QuiÃ©n te cubre durante la ausencia?</label>
            <select id="sustituto">
              <option value="">â€” Sin sustituto designado â€”</option>
              <option value="joan">Joan Ferrer (Director Ops)</option>
              <option value="marta">Marta IbÃ¡Ã±ez</option>
              <option value="sofia">SofÃ­a Romero</option>
              <option value="alex">Ã€lex Torrent</option>
              <option value="otro">Otro (especificar en comentario)</option>
            </select>
            <span class="field-hint">Recomendado para ausencias de mÃ¡s de 3 dÃ­as</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Confirma envÃ­o a -->
        <div style="display:flex;align-items:center;gap:10px;font-size:13px;color:var(--stone);">
          <span style="font-size:16px">ğŸ“¨</span>
          <span>La solicitud se enviarÃ¡ a <strong style="color:var(--moss)">Joan Ferrer</strong> vÃ­a Microsoft Teams y quedarÃ¡ registrada en RRHH.</span>
        </div>

        <button class="btn-submit" id="btnSubmit" onclick="submitForm()">
          <span>ğŸŒ¿</span>
          <span>Enviar solicitud</span>
        </button>

      </div>
    </div>

    <!-- â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="sidebar">

      <!-- Mini calendar -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon green">ğŸ“†</div>
          <div class="card-title">Calendario</div>
        </div>
        <div class="mini-cal">
          <div class="cal-nav">
            <button class="cal-btn" onclick="prevMonth()">â€¹</button>
            <div class="cal-month" id="calMonth">â€”</div>
            <button class="cal-btn" onclick="nextMonth()">â€º</button>
          </div>
          <div class="cal-grid" id="calGrid"></div>
          <div class="cal-legend">
            <div class="cal-legend-item">
              <div class="cal-legend-dot" style="background:var(--moss)"></div>
              Seleccionado
            </div>
            <div class="cal-legend-item">
              <div class="cal-legend-dot" style="background:var(--mist);border:1px solid var(--mint)"></div>
              Rango
            </div>
            <div class="cal-legend-item">
              <div class="cal-legend-dot" style="background:var(--amber-lt);border:1px solid var(--amber)"></div>
              Festivo
            </div>
          </div>
        </div>
      </div>

      <!-- Solicitudes anteriores -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon amber">ğŸ—‚ï¸</div>
          <div class="card-title">Mis solicitudes 2025</div>
        </div>
        <div class="card-body" style="padding-top:16px;">
          <div class="req-list" id="reqList"></div>
        </div>
      </div>

    </div>
  </div>
</main>

<!-- â”€â”€ SUCCESS OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="success-overlay" id="successOverlay">
  <div class="success-card">
    <div class="success-icon">ğŸŒ¿</div>
    <div class="success-title">Â¡Solicitud enviada!</div>
    <div class="success-sub">Joan Ferrer recibirÃ¡ tu peticiÃ³n por Teams y te responderÃ¡ en un mÃ¡ximo de 48 horas.</div>
    <div class="success-detail" id="successDetail"></div>
    <button class="btn-back" onclick="resetForm()">Volver al formulario</button>
  </div>
</div>

<!-- â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toast" id="toast">
  <span class="toast-icon" id="toastIcon">âœ…</span>
  <span id="toastMsg"></span>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FESTIVOS_2025 = [
  '2025-01-01','2025-01-06','2025-04-18','2025-04-21',
  '2025-05-01','2025-06-09','2025-06-24','2025-08-15',
  '2025-09-11','2025-09-24','2025-10-12','2025-11-01',
  '2025-12-08','2025-12-25','2025-12-26'
];

const PREV_REQUESTS = [
  { desde: '2025-03-17', hasta: '2025-03-21', dias: 5, tipo: 'Vacaciones', estado: 'aprobada' },
  { desde: '2025-05-29', hasta: '2025-06-02', dias: 4, tipo: 'Vacaciones', estado: 'aprobada' },
  { desde: '2025-07-21', hasta: '2025-07-25', dias: 5, tipo: 'Vacaciones', estado: 'pendiente' },
];

let calYear = new Date().getFullYear();
let calMonth = new Date().getMonth();
let selectedTipo = 'vacaciones';
let diasDisponibles = 14;

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  const today = new Date();
  const min = today.toISOString().split('T')[0];
  document.getElementById('fechaDesde').min = min;
  document.getElementById('fechaHasta').min = min;
  renderCalendar();
  renderRequests();
});

// â”€â”€ TYPE SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setType(el, val) {
  document.querySelectorAll('.type-opt').forEach(o => o.classList.remove('active'));
  el.classList.add('active');
  selectedTipo = val;
}

// â”€â”€ DAYS CALCULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isWeekday(d) { const day = d.getDay(); return day !== 0 && day !== 6; }
function isFestivo(d) {
  const s = d.toISOString().split('T')[0];
  return FESTIVOS_2025.includes(s);
}
function workingDays(from, to) {
  let count = 0, cur = new Date(from);
  while (cur <= to) {
    if (isWeekday(cur) && !isFestivo(cur)) count++;
    cur.setDate(cur.getDate() + 1);
  }
  return count;
}

function calcDays() {
  const desde = document.getElementById('fechaDesde').value;
  const hasta = document.getElementById('fechaHasta').value;
  const preview = document.getElementById('daysPreview');
  const count = document.getElementById('dpCount');
  const solic = document.getElementById('diasSolic');

  if (!desde || !hasta) { preview.classList.remove('visible'); solic.textContent = '0'; return; }

  const d = new Date(desde + 'T12:00:00');
  const h = new Date(hasta + 'T12:00:00');

  if (h < d) {
    document.getElementById('fieldHasta').classList.add('has-error');
    preview.classList.remove('visible');
    return;
  }
  document.getElementById('fieldHasta').classList.remove('has-error');

  const dias = workingDays(d, h);
  count.textContent = dias + (dias === 1 ? ' dÃ­a' : ' dÃ­as');
  count.className = 'dp-count' + (dias > diasDisponibles ? ' over' : '');
  solic.textContent = dias;
  solic.style.color = dias > diasDisponibles ? 'var(--error)' : 'var(--amber)';
  preview.classList.add('visible');

  // Update calendar range highlight
  calYear = d.getFullYear();
  calMonth = d.getMonth();
  renderCalendar();
}

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MONTHS = ['Enero','Febrero','Marzo','Abril','Mayo','Junio',
  'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const DOWS = ['Lu','Ma','Mi','Ju','Vi','Sa','Do'];

function prevMonth() { calMonth--; if (calMonth < 0) { calMonth = 11; calYear--; } renderCalendar(); }
function nextMonth() { calMonth++; if (calMonth > 11) { calMonth = 0; calYear++; } renderCalendar(); }

function renderCalendar() {
  document.getElementById('calMonth').textContent = MONTHS[calMonth] + ' ' + calYear;
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';

  // Day-of-week headers (Monday first)
  DOWS.forEach(d => {
    const el = document.createElement('div');
    el.className = 'cal-dow'; el.textContent = d;
    grid.appendChild(el);
  });

  const desde = document.getElementById('fechaDesde')?.value;
  const hasta  = document.getElementById('fechaHasta')?.value;
  const rangeStart = desde ? new Date(desde + 'T12:00:00') : null;
  const rangeEnd   = hasta  ? new Date(hasta  + 'T12:00:00') : null;

  const firstDay = new Date(calYear, calMonth, 1);
  const lastDay  = new Date(calYear, calMonth + 1, 0);
  const today = new Date(); today.setHours(12,0,0,0);

  // Monday = 0 offset
  let startDow = firstDay.getDay(); // 0=Sun
  startDow = startDow === 0 ? 6 : startDow - 1;

  // Fill prefix blanks
  for (let i = 0; i < startDow; i++) {
    const el = document.createElement('div');
    el.className = 'cal-day empty';
    grid.appendChild(el);
  }

  for (let day = 1; day <= lastDay.getDate(); day++) {
    const date = new Date(calYear, calMonth, day, 12);
    const el = document.createElement('div');
    el.textContent = day;

    let cls = 'cal-day';
    const isToday = date.toDateString() === today.toDateString();
    const isPast = date < today && !isToday;
    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
    const isFest = isFestivo(date);

    if (isPast) cls += ' past';
    if (isToday) cls += ' today';
    if (isWeekend) cls += ' weekend';
    if (isFest) cls += ' festivo';

    if (rangeStart && rangeEnd) {
      const isStart = date.toDateString() === rangeStart.toDateString();
      const isEnd   = date.toDateString() === rangeEnd.toDateString();
      const inRange = date > rangeStart && date < rangeEnd;
      if (isStart) cls += ' range-start';
      if (isEnd)   cls += ' range-end';
      if (inRange) cls += ' in-range';
    } else if (rangeStart) {
      if (date.toDateString() === rangeStart.toDateString()) cls += ' range-start range-end';
    }

    el.className = cls;
    el.title = isFest ? 'ğŸ‰ Festivo' : '';

    // Click to set date
    if (!isPast) {
      el.addEventListener('click', () => {
        const s = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const fd = document.getElementById('fechaDesde');
        const fh = document.getElementById('fechaHasta');
        if (!fd.value || (fd.value && fh.value)) {
          fd.value = s; fh.value = '';
        } else {
          if (new Date(s + 'T12:00:00') < new Date(fd.value + 'T12:00:00')) {
            fd.value = s;
          } else {
            fh.value = s;
          }
        }
        calcDays();
      });
    }

    grid.appendChild(el);
  }
}

// â”€â”€ REQUESTS LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRequests(extra = null) {
  const list = document.getElementById('reqList');
  const all = extra ? [...PREV_REQUESTS, extra] : PREV_REQUESTS;
  list.innerHTML = all.map(r => {
    const d = new Date(r.desde + 'T12:00:00');
    const h = new Date(r.hasta + 'T12:00:00');
    const fmt = (dt) => dt.toLocaleDateString('es-ES', {day:'numeric',month:'short'});
    return `
      <div class="req-item">
        <div class="req-status ${r.estado}"></div>
        <div class="req-info">
          <div class="req-dates">${fmt(d)} â€” ${fmt(h)}</div>
          <div class="req-meta">${r.dias} dÃ­as Â· ${r.tipo}</div>
        </div>
        <span class="req-badge ${r.estado}">${r.estado}</span>
      </div>`;
  }).join('');
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function showToast(msg, type = 'ok') {
  const t = document.getElementById('toast');
  const icon = document.getElementById('toastIcon');
  document.getElementById('toastMsg').textContent = msg;
  icon.textContent = type === 'error' ? 'âŒ' : 'âœ…';
  t.className = 'toast' + (type === 'error' ? ' error' : '');
  t.classList.add('visible');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('visible'), 3500);
}

// â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitForm() {
  const desde = document.getElementById('fechaDesde').value;
  const hasta  = document.getElementById('fechaHasta').value;
  let valid = true;

  document.getElementById('fieldDesde').classList.remove('has-error');
  document.getElementById('fieldHasta').classList.remove('has-error');

  if (!desde) {
    document.getElementById('fieldDesde').classList.add('has-error');
    document.getElementById('errDesde').textContent = 'La fecha de inicio es obligatoria';
    valid = false;
  }
  if (!hasta) {
    document.getElementById('fieldHasta').classList.add('has-error');
    document.getElementById('errHasta').textContent = 'La fecha de fin es obligatoria';
    valid = false;
  }
  if (desde && hasta && new Date(hasta) < new Date(desde)) {
    document.getElementById('fieldHasta').classList.add('has-error');
    document.getElementById('errHasta').textContent = 'La fecha de fin debe ser igual o posterior al inicio';
    valid = false;
  }
  if (!valid) { showToast('Revisa los campos marcados en rojo', 'error'); return; }

  const d = new Date(desde + 'T12:00:00');
  const h = new Date(hasta  + 'T12:00:00');
  const dias = workingDays(d, h);
  const fmt = (dt) => dt.toLocaleDateString('es-ES', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
  const tipoLabel = {'vacaciones':'Vacaciones','asuntos_propios':'Asuntos propios','enfermedad':'Baja mÃ©dica','otro':'Otro motivo'}[selectedTipo];
  const sustituto = document.getElementById('sustituto');
  const sustText = sustituto.options[sustituto.selectedIndex].text;
  const comentario = document.getElementById('comentario').value;

  const nRef = 'FRO-' + String(Math.floor(Math.random()*9000)+1000);
  const detHTML = `
    <strong>Referencia:</strong> ${nRef}<br>
    <strong>Tipo:</strong> ${tipoLabel}<br>
    <strong>Inicio:</strong> ${fmt(d)}<br>
    <strong>Fin:</strong> ${fmt(h)}<br>
    <strong>DÃ­as laborables:</strong> ${dias}<br>
    ${sustText !== 'â€” Sin sustituto designado â€”' ? '<strong>Sustituto:</strong> ' + sustText + '<br>' : ''}
    ${comentario ? '<strong>Comentario:</strong> ' + comentario : ''}
  `;
  document.getElementById('successDetail').innerHTML = detHTML;

  // Add to list
  const newReq = { desde, hasta, dias, tipo: tipoLabel, estado: 'pendiente' };
  PREV_REQUESTS.push(newReq);
  renderRequests();

  // Update balance
  const currentDisp = parseInt(document.getElementById('diasDisp').textContent);
  const currentUsados = parseInt(document.getElementById('diasUsados').textContent);
  document.getElementById('diasDisp').textContent = Math.max(0, currentDisp - dias);
  document.getElementById('diasUsados').textContent = currentUsados + dias;
  diasDisponibles = Math.max(0, currentDisp - dias);

  document.getElementById('successOverlay').classList.add('visible');
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetForm() {
  document.getElementById('successOverlay').classList.remove('visible');
  document.getElementById('fechaDesde').value = '';
  document.getElementById('fechaHasta').value = '';
  document.getElementById('comentario').value = '';
  document.getElementById('sustituto').selectedIndex = 0;
  document.getElementById('daysPreview').classList.remove('visible');
  document.getElementById('diasSolic').textContent = '0';
  document.querySelectorAll('.type-opt').forEach((o,i) => {
    if (i === 0) o.classList.add('active'); else o.classList.remove('active');
  });
  selectedTipo = 'vacaciones';
  renderCalendar();
  showToast('Formulario reiniciado. Â¡Puedes hacer otra solicitud!');
}

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const USERS = {
  'carlos.mendoza@frondoso.eu': { pass: 'frondoso2025', name: 'Carlos Mendoza', role: 'Project Manager Â· Operaciones', initials: 'CM' },
  'joan.ferrer@frondoso.eu':    { pass: 'frondoso2025', name: 'Joan Ferrer',    role: 'Director de Operaciones',        initials: 'JF' },
  'laia.camps@frondoso.eu':     { pass: 'frondoso2025', name: 'Laia Camps',     role: 'Responsable RRHH',               initials: 'LC' },
  'magda@frondoso.eu': { pass: 'frondoso2025', name: 'Magda Vilanova', role: 'DiseÃ±adora de Jardines Â· DiseÃ±o & BotÃ¡nica', initials: 'MV' },
  'victor.pla@frondoso.eu':     { pass: 'frondoso2025', name: 'VÃ­ctor Pla',     role: 'TÃ©cnico de InstalaciÃ³n Â· Operaciones',       initials: 'VP' },
};

function fillCreds(email, pass) {
  document.getElementById('loginEmail').value = email;
  document.getElementById('loginPass').value = pass;
  document.getElementById('loginEmail').focus();
}

function doLogin() {
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const pass  = document.getElementById('loginPass').value;
  const btn   = document.getElementById('btnLogin');
  const errEl = document.getElementById('loginErrorMsg');
  const errTxt= document.getElementById('loginErrorText');

  errEl.classList.remove('visible');
  document.getElementById('loginEmail').classList.remove('login-error');
  document.getElementById('loginPass').classList.remove('login-error');

  if (!email) {
    document.getElementById('loginEmail').classList.add('login-error');
    errTxt.textContent = 'Introduce tu email corporativo.';
    errEl.classList.add('visible'); return;
  }
  if (!pass) {
    document.getElementById('loginPass').classList.add('login-error');
    errTxt.textContent = 'Introduce tu contraseÃ±a.';
    errEl.classList.add('visible'); return;
  }

  // Loading state
  btn.classList.add('loading');
  btn.disabled = true;

  setTimeout(() => {
    const user = USERS[email];
    if (!user || user.pass !== pass) {
      btn.classList.remove('loading'); btn.disabled = false;
      document.getElementById('loginEmail').classList.add('login-error');
      document.getElementById('loginPass').classList.add('login-error');
      errTxt.textContent = 'Usuario o contraseÃ±a incorrectos. IntÃ©ntalo de nuevo.';
      errEl.classList.add('visible');
      document.getElementById('loginPass').value = '';
      return;
    }

    // Success â€” update UI with user data
    document.querySelector('.user-name').textContent = user.name;
    document.querySelector('.user-role').textContent = user.role;
    document.querySelector('.avatar').textContent = user.initials;

    // Transition
    const loginPage = document.getElementById('loginPage');
    loginPage.classList.add('hidden');
    document.getElementById('appWrapp